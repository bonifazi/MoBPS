png(file="C:/Users/pook/Desktop/Image.png", width=2250, height= 760, res=300)
par(mfrow=c(1,2))
par(mar=c(2.1,4.1,1.1,0.6))
inbreed <- NULL
for(i in c(25,50)){
  library(MoBPS)
  # Generate a starting population with allele 0 coding White-Layer, allele 1 coding wild-race
  dataset1 <- matrix(1, nrow=5000, ncol=20)
  dataset2 <- matrix(0, nrow=5000, ncol=20)
  
  # Generation of traits
  # Blue Eggshell QTL is on SNP 2000 on chromosome 1
  # In all other positions the white layer genome is assumed to be favourable
  # but all marker effects combiened are modelled as smaller as the blue eggshell QTL
  trait <- c(2000,1, 0, 10000, 20000)
  trait2 <- cbind(1:5000,1,1,0.5,0)
  
  population <- creating.diploid(dataset=cbind(dataset1,dataset2), miraculix=TRUE,
                                 real.bv.add=rbind(trait, trait2), name.cohort="Founders")
  
  # Simulate mating. In each generation the top 25 cocks of the previous generation
  # with the 10 hens of the foundering population
  # Target: Increase share of white layer while preserving blue egg shell QTL
  
  population <- breeding.diploid(population, breeding.size=c(100,100), selection.size=c(10,10),
                                 best1.from.cohort="Founders_M", best2.from.cohort="Founders_F",
                                 name.cohort="F1", selection.criteria.type = "bv")
  population <- breeding.diploid(population, breeding.size=c(100,100), selection.size=c(i,10),
                                 best1.from.cohort="F1_M", best2.from.cohort="Founders_F",
                                 name.cohort="BC1", selection.m="function",
                                 selection.criteria.type = "bv")
  population <- breeding.diploid(population, breeding.size=c(100,100), selection.size=c(i,10),
                                 best1.from.cohort="BC1_M", best2.from.cohort="Founders_F",
                                 name.cohort="BC2", selection.m="function",
                                 selection.criteria.type = "bv")
  population <- breeding.diploid(population, breeding.size=c(100,100), selection.size=c(i,10),
                                 best1.from.cohort="BC2_M", best2.from.cohort="Founders_F",
                                 name.cohort="BC3", selection.m="function",
                                 selection.criteria.type = "bv")
  # Final generation: Use newly generated hens to get animals that are homozygous in blue egg shell QTL
  
  population <- breeding.diploid(population, breeding.size=c(100,100), selection.size=c(i,i),
                                 best1.from.cohort="BC3_M", best2.from.cohort="BC3_F",
                                 name.cohort="IC", selection.m="function",
                                 selection.criteria.type = "bv")
  
  # Check genomic share of wild race in the final generation
  genoIC <- get.geno(population, cohort="IC_M")
  plot(rowSums(genoIC)/100, xlab="genome", ylab="frequency of wild allele", main=paste0("i = ", i/100))
  inbreed <- c(inbreed,mean(diag(kinship.emp(population$breeding[[6]][[2]]))*2))
  abline(v=2000)
}
dev.off()

